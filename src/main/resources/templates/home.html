<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout.html}">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        /* 전체적인 스타일 */
        body {
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 0;
        }

        .home-container {
            padding: 30px;
        }

        /* 제목 크기 조정 */
        .home-card h4 {
            font-size: 1.2rem; /* 이전보다 작은 크기 */
        }

        .home-card h5 {
            font-size: 1rem; /* 이전보다 작은 크기 */
        }

        /* 테이블 텍스트 크기 조정 */
        .table th, .table td {
            font-size: 0.9rem; /* 테이블 헤더와 내용의 글자 크기 조정 */
        }

        /* 카드 스타일 */
        .home-card {
            background-color: #ffffff;
            border-radius: 15px;
            border: 1px solid #dee2e6;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .home-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .home-card-header {
            border-bottom: 2px solid #8ab4f8;
            margin-bottom: 15px;
            padding-bottom: 10px;
        }

        .home-card h4, .home-card h5 {
            font-weight: 600;
            color: #343a40;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .home-card-header h5 span {
            color: #007bff;
            font-weight: bold;
        }

        /* Subheader style */
        .home-card-subheader {
            border-bottom: 1px solid #d0d0d0;
            margin-bottom: 10px;
            padding-bottom: 5px;
        }

        .fixed-box {
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .table th {
            background-color: #e9ecef;
            color: #495057;

        }

        .table tr:hover {
            background-color: #f1f3f5;
        }

        .table td {
            color: #666;
        }

        .home-card-body {
            opacity: 0;
            transform: translateY(10px);
            animation: fadeInUp 0.4s ease-out forwards;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .mb-4 {
            margin-bottom: 24px !important;
        }


        .status-circle {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }


        .waiting-circle {
            background-color: #dc3545;
        }

        .in-treatment-circle{
            background-color: #ffcc00;
        }

        .completed-circle{
            background-color: #28a745;
        }


    </style>
</head>

<body>
<div layout:fragment="home" class="home-container">


    <div class="container-fluid mt-4">
        <div class="row">
            <!-- 진료현황 Section -->
            <div class="col-lg-6 mb-4">
                <div class="home-card">
                    <div class="home-card-header text-center d-flex justify-content-between align-items-center">
                        <h4 class="mb-0 flex-grow-1 text-center">진료현황</h4>
                        <i class="bi bi-box-arrow-in-up-right fs-5"></i>
                    </div>
                    <div class="home-card-body">
                        <div class="row">
                            <!-- 대기중 Section -->
                            <div class="col-lg-4 col-md-6 mb-4 waiting-section">
                                <div class="home-card h-100">
                                    <div class="home-card-header text-center home-card-subheader">
                                        <h5>
                                            <span class="status-circle waiting-circle"></span> 대기중 (<span id="home-waitingCount">0</span>명)
                                        </h5>
                                    </div>
                                    <div class="fixed-box">
                                        <table class="table home-table">
                                            <thead>
                                            <tr>
                                                <th>환자명</th>
                                                <th>접수시간</th>
                                                <th>대기시간</th>
                                            </tr>
                                            </thead>
                                            <tbody id="home-waitingList">
                                            <tr>
                                                <td colspan="3">현재 대기중인 환자가 없습니다.</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- 진료중 Section -->
                            <div class="col-lg-4 col-md-6 mb-4 in-treatment-section">
                                <div class="home-card h-100">
                                    <div class="home-card-header text-center home-card-subheader">
                                        <h5>
                                            <span class="status-circle in-treatment-circle"></span> 진료중 (<span id="home-inTreatmentCount">0</span>명)
                                        </h5>
                                    </div>
                                    <div class="fixed-box">
                                        <table class="table home-table">
                                            <thead>
                                            <tr>
                                                <th>환자명</th>
                                                <th>진료시작시간</th>
                                                <th>진료시간</th>
                                            </tr>
                                            </thead>
                                            <tbody id="home-inTreatmentList">
                                            <tr>
                                                <td colspan="3">현재 진료중인 환자가 없습니다.</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- 진료완료 Section -->
                            <div class="col-lg-4 col-md-6 mb-4 completed-section">
                                <div class="home-card h-100">
                                    <div class="home-card-header text-center home-card-subheader">
                                        <h5>
                                            <span class="status-circle completed-circle"></span> 진료완료 (<span id="home-completedCount">0</span>명)
                                        </h5>
                                    </div>
                                    <div class="fixed-box">
                                        <table class="table home-table">
                                            <thead>
                                            <tr>
                                                <th>환자명</th>
                                                <th>진료완료시간</th>
                                            </tr>
                                            </thead>
                                            <tbody id="home-completedList">
                                            <tr>
                                                <td colspan="2">현재 진료완료된 환자가 없습니다.</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 진료구분 Section -->
            <div class="col-lg-6 mb-4">
                <div class="home-card">
                    <div class="home-card-header text-center d-flex justify-content-between align-items-center">
                        <h4 class="mb-0 flex-grow-1 text-center">진료구분</h4>
                        <i class="bi bi-box-arrow-in-up-right fs-5"></i>
                    </div>
                    <div class="home-card-body">
                        <div class="row">
                            <!-- 일반진료 Section -->
                            <div class="col-lg-4 col-md-6 mb-4 general-treatment-section">
                                <div class="home-card h-100">
                                    <div class="home-card-header text-center home-card-subheader">
                                        <h5>
                                            일반진료환자 (<span id="home-generalPatientCount">0</span>명)
                                        </h5>
                                    </div>
                                    <div class="fixed-box">
                                        <table class="table home-table">
                                            <thead>
                                            <tr>
                                                <th>환자명</th>
                                                <th>진료상태</th>
                                            </tr>
                                            </thead>
                                            <tbody id="home-generalPatientList">
                                            <tr>
                                                <td colspan="2">현재 일반진료환자가 없습니다.</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- 수술 Section -->
                            <div class="col-lg-4 col-md-6 mb-4 surgery-section">
                                <div class="home-card h-100">
                                    <div class="home-card-header text-center home-card-subheader">
                                        <h5>
                                            수술 (<span id="home-surgeryCount">0</span>명)
                                        </h5>
                                    </div>
                                    <div class="fixed-box">
                                        <table class="table home-table">
                                            <thead>
                                            <tr>
                                                <th>환자명</th>
                                                <th>진료상태</th>
                                            </tr>
                                            </thead>
                                            <tbody id="home-surgeryList">
                                            <tr>
                                                <td colspan="2">현재 진행중인 수술이 없습니다.</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <!-- 신규환자 Section -->
                            <div class="col-lg-4 col-md-6 mb-4 new-patient-section">
                                <div class="home-card h-100">
                                    <div class="home-card-header text-center home-card-subheader">
                                        <h5>
                                            신규환자 (<span id="home-newPatientCount">0</span>명)
                                        </h5>
                                    </div>
                                    <div class="fixed-box">
                                        <table class="table home-table">
                                            <thead>
                                            <tr>
                                                <th>환자명</th>
                                                <th>진료상태</th>
                                            </tr>
                                            </thead>
                                            <tbody id="home-newPatientList">
                                            <tr>
                                                <td colspan="2">현재 신규환자가 없습니다.</td>
                                            </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Section -->
        <div class="row">
            <!-- 공지사항 Section -->
            <div class="col-lg-8 mb-4">
                <div class="home-card">
                    <div class="home-card-header text-center d-flex justify-content-between align-items-center">
                        <h4 class="mb-0 flex-grow-1 text-center">공지사항</h4>
                        <i class="bi bi-box-arrow-in-up-right fs-5"></i>
                    </div>
                    <div class="home-card-body">
                        <div class="fixed-box">
                            <table class="table home-table">
                                <thead>
                                <tr>
                                    <th>제목</th>
                                    <th>내용</th>
                                    <th>등록일</th>
                                </tr>
                                </thead>
                                <tbody id="home-noticeList">
                                <tr>
                                    <td colspan="3">등록된 공지사항이 없습니다.</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 최소보관수량 미달 품목 리스트 Section -->
            <div class="col-lg-4 mb-4">
                <div class="home-card">
                    <div class="home-card-header text-center d-flex justify-content-between align-items-center">
                        <h4 class="mb-0 flex-grow-1 text-center">최소보관수량 미달 품목 리스트</h4>
                        <i class="bi bi-box-arrow-in-up-right fs-5"></i>
                    </div>
                    <div class="home-card-body">
                        <div class="fixed-box">
                            <table class="table home-table">
                                <thead>
                                <tr>
                                    <th>재료명</th>
                                    <th>재료코드</th>
                                    <th>부족수량</th>
                                </tr>
                                </thead>
                                <tbody id="lowStockList">
                                <tr>
                                    <td colspan="3">최소보관수량 미달품목이 없습니다.</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Script is loaded');
            console.log('DOM fully loaded and parsed'); // 로그 추가
            // 현재 날짜를 yyyy-MM-dd 형식으로 가져오는 함수
            function getCurrentDate() {
                const today = new Date();
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0');
                const dd = String(today.getDate()).padStart(2, '0');
                return `${yyyy}-${mm}-${dd}`;
            }

            // 주어진 상태 코드에 맞는 환자 수를 가져오는 함수
            function fetchTreatmentCount(status) {
                const currentDate = getCurrentDate();
                const url = `/api/patient-admission/completeTreatment/${status}/${currentDate}`;

                console.log(`Fetching data from: ${url}`); // URL 확인

                fetch(url)
                    .then(response => {
                        if (!response.ok) {
                            return response.json().then(err => {
                                console.error('Error details:', err); // 에러 세부 정보 출력
                                throw new Error(err.message || '진료 시작 실패');
                            });
                        }
                        return response.json();
                    })
                    .then(count => {
                        console.log(`Status ${status} has ${count} patients.`); // 받은 데이터 확인

                        // 각각의 상태에 따른 카운트 업데이트
                        if (status === 1) {
                            document.getElementById('home-waitingCount').textContent = count;
                        } else if (status === 2) {
                            document.getElementById('home-inTreatmentCount').textContent = count;
                        } else if (status === 3) {
                            document.getElementById('home-completedCount').textContent = count;
                        }
                    })
                    .catch(error => console.error('Error fetching count:', error));
            }

            // // 5초마다 대기중, 진료중, 진료완료 환자 수를 업데이트
            // setInterval(() => {
            //     console.log('Fetching treatment counts...'); // 로그 추가
            //     fetchTreatmentCount(1); // 대기중 환자 수
            //     fetchTreatmentCount(2); // 진료중 환자 수
            //     fetchTreatmentCount(3); // 진료완료 환자 수
            // }, 1000);
        });


    </script>
</div>

</body>
</html>
